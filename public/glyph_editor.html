<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>POI Glyph Editor</title>
<style>
  body { font-family: monospace; background: #1a1a1a; color: #ddd; margin: 20px; }
  h1 { color: #fff; font-size: 18px; }
  h2 { color: #aaa; font-size: 14px; margin-top: 28px; border-top: 2px solid #555; padding-top: 8px; }
  .glyph-row { display: flex; gap: 16px; margin-bottom: 24px; border-bottom: 1px solid #333; padding-bottom: 16px; }
  .glyph-info { width: 180px; flex-shrink: 0; }
  .glyph-info h3 { margin: 0 0 4px; color: #fff; font-size: 14px; }
  .glyph-info .color-swatch { display: inline-block; width: 12px; height: 12px; border-radius: 2px; margin-right: 6px; vertical-align: middle; }
  .glyph-info .tags { font-size: 11px; color: #999; margin-top: 4px; }
  .glyph-previews { display: flex; gap: 8px; align-items: end; flex-shrink: 0; }
  .glyph-preview { text-align: center; }
  .glyph-preview canvas { border: 1px solid #444; background: rgb(238, 210, 210); display: block; margin-bottom: 2px; }
  .glyph-preview .size-label { font-size: 10px; color: #888; }
  .glyph-code { flex: 1; min-width: 0; }
  .glyph-code textarea {
    width: 100%; height: 140px; background: #222; color: #ccc; border: 1px solid #444;
    font-family: monospace; font-size: 11px; padding: 6px; resize: vertical;
    tab-size: 2;
  }
  .glyph-code button {
    margin-top: 4px; padding: 3px 10px; background: #444; color: #ddd; border: 1px solid #666;
    cursor: pointer; font-family: monospace; font-size: 11px;
  }
  .glyph-code button:hover { background: #555; }
  .error { color: #e74c3c; font-size: 11px; margin-top: 2px; min-height: 14px; }
</style>
</head>
<body>
<h1>POI Glyph Editor</h1>
<div id="container"></div>
<script>

const COLORS = {
  foodDrink: { r: 231, g: 76, b: 60 },
  shopping: { r: 155, g: 89, b: 182 },
  health: { r: 46, g: 204, b: 113 },
  tourism: { r: 230, g: 126, b: 34 },
  historic: { r: 139, g: 69, b: 19 },
  services: { r: 52, g: 152, b: 219 },
  transport: { r: 26, g: 188, b: 156 },
  education: { r: 243, g: 156, b: 18 },
  nightlife: { r: 233, g: 30, b: 144 },
};

const SECTIONS = [
  {
    title: "Food & Drink",
    glyphs: {
      cafe: {
        label: "Cafe",
        tags: "amenity=cafe, shop=coffee/tea",
        colorKey: "foodDrink",
        code: `// Coffee cup
const cw = r * 1.0, ch = r * 0.8;
ctx.beginPath();
ctx.rect(cx - cw / 2, cy - ch / 2 + 1, cw, ch);
haloFill();
// Handle
ctx.beginPath();
ctx.arc(cx + cw / 2, cy + 1, ch * 0.35, -Math.PI * 0.4, Math.PI * 0.4);
haloStroke(1.5);
// Steam
ctx.beginPath();
ctx.moveTo(cx - r * 0.2, cy - ch / 2 - 1);
ctx.quadraticCurveTo(cx - r * 0.3, cy - ch / 2 - r * 0.5, cx - r * 0.1, cy - ch / 2 - r * 0.7);
ctx.moveTo(cx + r * 0.2, cy - ch / 2 - 1);
ctx.quadraticCurveTo(cx + r * 0.1, cy - ch / 2 - r * 0.5, cx + r * 0.3, cy - ch / 2 - r * 0.7);
haloStroke(0.8);`,
      },
      restaurant: {
        label: "Restaurant",
        tags: "amenity=restaurant/fast_food/food_court/bbq",
        colorKey: "foodDrink",
        code: `// Plate with fork and knife
ctx.beginPath();
ctx.arc(cx, cy, r * 0.75, 0, Math.PI * 2);
haloFill();
// Fork
const forkX = cx - r * 1.15;
ctx.beginPath();
ctx.moveTo(forkX, cy + r);
ctx.lineTo(forkX, cy - r * 0.1);
ctx.moveTo(forkX - r * 0.2, cy - r * 0.1);
ctx.lineTo(forkX - r * 0.2, cy - r * 0.7);
ctx.moveTo(forkX, cy - r * 0.1);
ctx.lineTo(forkX, cy - r * 0.7);
ctx.moveTo(forkX + r * 0.2, cy - r * 0.1);
ctx.lineTo(forkX + r * 0.2, cy - r * 0.7);
haloStroke(1.2);
// Knife
const knifeX = cx + r * 1.15;
ctx.beginPath();
ctx.moveTo(knifeX, cy + r);
ctx.lineTo(knifeX, cy - r * 0.2);
ctx.lineTo(knifeX + r * 0.15, cy - r * 0.5);
ctx.lineTo(knifeX, cy - r * 0.8);
haloStroke(1.2);`,
      },
      bakery: {
        label: "Bakery",
        tags: "shop=bakery/pastry",
        colorKey: "foodDrink",
        code: `// Croissant
ctx.beginPath();
const lx = cx - r * 1.2, ly = cy + r * 0.1;
const rx = cx + r * 1.2, ry = cy + r * 0.1;
ctx.moveTo(lx, ly);
ctx.bezierCurveTo(cx - r * 0.6, cy - r * 1.0, cx + r * 0.6, cy - r * 1.0, rx, ry);
ctx.bezierCurveTo(cx + r * 0.5, cy + r * 0.3, cx - r * 0.5, cy + r * 0.3, lx, ly);
ctx.closePath();
haloFill();
// Score lines
ctx.strokeStyle = "rgba(255,255,255,0.5)";
ctx.lineWidth = 0.8;
for (let i = -1; i <= 1; i++) {
  const ox = cx + i * r * 0.35;
  ctx.beginPath();
  ctx.moveTo(ox, cy - r * 0.5);
  ctx.lineTo(ox, cy + r * 0.05);
  ctx.stroke();
}`,
      },
      ice_cream: {
        label: "Ice Cream",
        tags: "amenity=ice_cream, shop=ice_cream",
        colorKey: "foodDrink",
        code: `// Ice cream sundae in a bowl
const bowlW = r * 1.1, bowlH = r * 0.5;
ctx.beginPath();
ctx.ellipse(cx, cy + r * 0.3, bowlW, bowlH, 0, 0, Math.PI);
haloFill();
// Scoop on top of bowl
ctx.beginPath();
ctx.arc(cx, cy - r * 0.15, r * 0.7, 0, Math.PI * 2);
haloFill();
// Small scoop on top
ctx.beginPath();
ctx.arc(cx, cy - r * 0.8, r * 0.4, 0, Math.PI * 2);
haloFill();`,
      },
      drinks: {
        label: "Drinks / Alcohol",
        tags: "shop=wine/beverages/alcohol",
        colorKey: "foodDrink",
        code: `// Wine bottle
const bw = r * 0.35;
// Bottle body
ctx.beginPath();
ctx.roundRect(cx - bw, cy - r * 0.1, bw * 2, r * 1.2, 2);
haloFill();
// Bottle neck
ctx.beginPath();
ctx.roundRect(cx - bw * 0.4, cy - r * 0.9, bw * 0.8, r * 0.85, 1);
haloFill();
// Label (white rectangle)
ctx.fillStyle = "white";
ctx.fillRect(cx - bw * 0.7, cy + r * 0.15, bw * 1.4, r * 0.4);`,
      },
    },
  },
  {
    title: "Shopping",
    glyphs: {
      supermarket: {
        label: "Supermarket",
        tags: "shop=supermarket/convenience",
        colorKey: "shopping",
        code: `// Shopping cart
const cartW = r * 1.0, cartH = r * 0.7;
const cartL = cx - r * 0.6, cartT = cy - r * 0.3;
ctx.beginPath();
ctx.moveTo(cartL, cartT);
ctx.lineTo(cartL + cartW * 1.2, cartT);
ctx.lineTo(cartL + cartW * 1.0, cartT + cartH);
ctx.lineTo(cartL + cartW * 0.15, cartT + cartH);
ctx.closePath();
haloFill();
// Handle
ctx.beginPath();
ctx.moveTo(cartL, cartT);
ctx.lineTo(cartL - r * 0.4, cartT - r * 0.3);
haloStroke(1.5);
// Wheels
ctx.beginPath();
ctx.arc(cartL + cartW * 0.3, cartT + cartH + r * 0.25, r * 0.2, 0, Math.PI * 2);
haloFill();
ctx.beginPath();
ctx.arc(cartL + cartW * 0.85, cartT + cartH + r * 0.25, r * 0.2, 0, Math.PI * 2);
haloFill();`,
      },
      florist: {
        label: "Florist",
        tags: "shop=florist/garden_centre",
        colorKey: "shopping",
        code: `// Flower — 5 petals around center
const petalR = r * 0.4;
const centerR = r * 0.25;
for (let i = 0; i < 5; i++) {
  const angle = (i / 5) * Math.PI * 2 - Math.PI / 2;
  const px = cx + Math.cos(angle) * r * 0.45;
  const py = cy + Math.sin(angle) * r * 0.45;
  ctx.beginPath();
  ctx.arc(px, py, petalR, 0, Math.PI * 2);
  haloFill();
}
// Center dot (white)
ctx.beginPath();
ctx.arc(cx, cy, centerR, 0, Math.PI * 2);
ctx.fillStyle = "white";
ctx.fill();`,
      },
      books: {
        label: "Books",
        tags: "shop=books",
        colorKey: "shopping",
        code: `// Open book
// Left page
ctx.beginPath();
ctx.moveTo(cx, cy - r * 0.6);
ctx.quadraticCurveTo(cx - r * 0.9, cy - r * 0.5, cx - r * 1.1, cy - r * 0.3);
ctx.lineTo(cx - r * 1.1, cy + r * 0.7);
ctx.quadraticCurveTo(cx - r * 0.9, cy + r * 0.5, cx, cy + r * 0.6);
ctx.closePath();
haloFill();
// Right page
ctx.beginPath();
ctx.moveTo(cx, cy - r * 0.6);
ctx.quadraticCurveTo(cx + r * 0.9, cy - r * 0.5, cx + r * 1.1, cy - r * 0.3);
ctx.lineTo(cx + r * 1.1, cy + r * 0.7);
ctx.quadraticCurveTo(cx + r * 0.9, cy + r * 0.5, cx, cy + r * 0.6);
ctx.closePath();
haloFill();
// Spine line
ctx.beginPath();
ctx.moveTo(cx, cy - r * 0.6);
ctx.lineTo(cx, cy + r * 0.6);
haloStroke(1.0);`,
      },
      shopping: {
        label: "Shopping (general)",
        tags: "shop=clothes/kiosk/electronics/etc",
        colorKey: "shopping",
        code: `// Shopping bag
const bw = r * 1.3, bh = r * 1.2;
ctx.beginPath();
ctx.rect(cx - bw / 2, cy - bh / 2 + 1, bw, bh);
haloFill();
// Handle
ctx.beginPath();
ctx.arc(cx, cy - bh / 2 + 1, bw * 0.28, Math.PI, 0);
haloStroke(1.5);`,
      },
    },
  },
  {
    title: "Health",
    glyphs: {
      pharmacy: {
        label: "Pharmacy",
        tags: "amenity=pharmacy",
        colorKey: "health",
        code: `// Mortar and pestle (Rx)
// Mortar bowl
ctx.beginPath();
ctx.ellipse(cx, cy + r * 0.2, r * 0.9, r * 0.55, 0, 0, Math.PI);
haloFill();
// Bowl rim
ctx.beginPath();
ctx.ellipse(cx, cy + r * 0.2, r * 1.0, r * 0.25, 0, Math.PI, 0);
haloFill();
// Pestle (diagonal stick)
ctx.beginPath();
ctx.moveTo(cx - r * 0.1, cy + r * 0.05);
ctx.lineTo(cx + r * 0.8, cy - r * 0.9);
haloStroke(2.5);`,
      },
      health: {
        label: "Health / Medical",
        tags: "amenity=doctors/dentist/hospital/clinic/veterinary",
        colorKey: "health",
        code: `// Medical cross
const cw = r * 0.5, ch = r * 1.3;
ctx.beginPath();
ctx.rect(cx - cw / 2, cy - ch / 2, cw, ch);
ctx.rect(cx - ch / 2, cy - cw / 2, ch, cw);
haloFill();`,
      },
    },
  },
  {
    title: "Tourism & Accommodation",
    glyphs: {
      hotel: {
        label: "Hotel / Accommodation",
        tags: "tourism=hotel/guest_house/hostel/motel/apartment/camp_site",
        colorKey: "tourism",
        code: `// Bed — headboard + mattress + pillow
// Bed frame
ctx.beginPath();
ctx.rect(cx - r * 1.0, cy - r * 0.1, r * 2.0, r * 0.7);
haloFill();
// Headboard (left side, taller)
ctx.beginPath();
ctx.rect(cx - r * 1.0, cy - r * 0.7, r * 0.3, r * 1.3);
haloFill();
// Pillow (white rounded rect)
ctx.fillStyle = "white";
ctx.beginPath();
ctx.roundRect(cx - r * 0.65, cy - r * 0.05, r * 0.5, r * 0.35, 2);
ctx.fill();
// Legs
ctx.beginPath();
ctx.moveTo(cx - r * 0.9, cy + r * 0.6);
ctx.lineTo(cx - r * 0.9, cy + r * 0.9);
ctx.moveTo(cx + r * 0.9, cy + r * 0.6);
ctx.lineTo(cx + r * 0.9, cy + r * 0.9);
haloStroke(1.5);`,
      },
      museum: {
        label: "Museum / Gallery",
        tags: "tourism=museum/gallery",
        colorKey: "tourism",
        code: `// Classical building with columns
// Pediment (triangle roof)
ctx.beginPath();
ctx.moveTo(cx - r * 1.1, cy - r * 0.2);
ctx.lineTo(cx, cy - r * 1.0);
ctx.lineTo(cx + r * 1.1, cy - r * 0.2);
ctx.closePath();
haloFill();
// Base
ctx.beginPath();
ctx.rect(cx - r * 1.1, cy + r * 0.6, r * 2.2, r * 0.25);
haloFill();
// 3 columns
for (let i = -1; i <= 1; i++) {
  ctx.beginPath();
  ctx.rect(cx + i * r * 0.6 - r * 0.12, cy - r * 0.2, r * 0.24, r * 0.8);
  haloFill();
}`,
      },
      sightseeing: {
        label: "Sightseeing / Attraction",
        tags: "tourism=artwork/viewpoint/attraction/zoo/theme_park/information/picnic_site",
        colorKey: "tourism",
        code: `// Camera
const bw = r * 1.4, bh = r * 0.9;
// Camera body
ctx.beginPath();
ctx.roundRect(cx - bw / 2, cy - bh / 2 + r * 0.1, bw, bh, 2);
haloFill();
// Viewfinder bump
ctx.beginPath();
ctx.rect(cx - r * 0.3, cy - bh / 2 - r * 0.15, r * 0.6, r * 0.3);
haloFill();
// Lens (white circle)
ctx.beginPath();
ctx.arc(cx, cy + r * 0.1, r * 0.35, 0, Math.PI * 2);
ctx.fillStyle = "white";
ctx.fill();
// Inner lens
ctx.beginPath();
ctx.arc(cx, cy + r * 0.1, r * 0.15, 0, Math.PI * 2);
ctx.fillStyle = colorStr;
ctx.fill();`,
      },
    },
  },
  {
    title: "Historic",
    glyphs: {
      historic: {
        label: "Historic",
        tags: "historic=monument/memorial/castle/ruins/etc",
        colorKey: "historic",
        code: `// Monument/obelisk
ctx.beginPath();
ctx.moveTo(cx - r * 0.35, cy + r);
ctx.lineTo(cx + r * 0.35, cy + r);
ctx.lineTo(cx + r * 0.2, cy - r * 0.4);
ctx.lineTo(cx, cy - r);
ctx.lineTo(cx - r * 0.2, cy - r * 0.4);
ctx.closePath();
haloFill();`,
      },
    },
  },
  {
    title: "Services",
    glyphs: {
      worship: {
        label: "Place of Worship",
        tags: "amenity=place_of_worship",
        colorKey: "services",
        code: `// Church/worship — cross on a base
// Vertical beam
ctx.beginPath();
ctx.rect(cx - r * 0.12, cy - r * 1.0, r * 0.24, r * 1.6);
haloFill();
// Horizontal beam
ctx.beginPath();
ctx.rect(cx - r * 0.5, cy - r * 0.5, r * 1.0, r * 0.24);
haloFill();
// Base
ctx.beginPath();
ctx.moveTo(cx - r * 0.5, cy + r * 0.6);
ctx.lineTo(cx + r * 0.5, cy + r * 0.6);
ctx.lineTo(cx + r * 0.35, cy + r * 0.9);
ctx.lineTo(cx - r * 0.35, cy + r * 0.9);
ctx.closePath();
haloFill();`,
      },
      cinema: {
        label: "Cinema",
        tags: "amenity=cinema",
        colorKey: "services",
        code: `// Film strip / screen
// Screen
ctx.beginPath();
ctx.rect(cx - r * 1.0, cy - r * 0.7, r * 2.0, r * 1.2);
haloFill();
// Inner screen (white)
ctx.fillStyle = "white";
ctx.fillRect(cx - r * 0.75, cy - r * 0.45, r * 1.5, r * 0.7);
// Film sprocket holes on sides
ctx.fillStyle = "white";
for (let i = -1; i <= 1; i++) {
  const y = cy - r * 0.3 + i * r * 0.35;
  ctx.fillRect(cx - r * 0.95, y, r * 0.12, r * 0.15);
  ctx.fillRect(cx + r * 0.83, y, r * 0.12, r * 0.15);
}`,
      },
      theatre: {
        label: "Theatre / Arts",
        tags: "amenity=theatre/arts_centre/events_venue",
        colorKey: "services",
        code: `// Comedy/tragedy masks
// Happy mask (left)
ctx.beginPath();
ctx.arc(cx - r * 0.35, cy - r * 0.05, r * 0.6, 0, Math.PI * 2);
haloFill();
// Happy mouth
ctx.beginPath();
ctx.arc(cx - r * 0.35, cy + r * 0.05, r * 0.25, 0, Math.PI);
ctx.strokeStyle = "white";
ctx.lineWidth = 1.2;
ctx.stroke();
// Happy eyes
ctx.fillStyle = "white";
ctx.beginPath();
ctx.arc(cx - r * 0.5, cy - r * 0.2, r * 0.08, 0, Math.PI * 2);
ctx.arc(cx - r * 0.2, cy - r * 0.2, r * 0.08, 0, Math.PI * 2);
ctx.fill();
// Sad mask (right, slightly behind)
ctx.beginPath();
ctx.arc(cx + r * 0.35, cy + r * 0.1, r * 0.6, 0, Math.PI * 2);
haloFill();
// Sad mouth
ctx.beginPath();
ctx.arc(cx + r * 0.35, cy + r * 0.45, r * 0.25, Math.PI, 0);
ctx.strokeStyle = "white";
ctx.lineWidth = 1.2;
ctx.stroke();
// Sad eyes
ctx.fillStyle = "white";
ctx.beginPath();
ctx.arc(cx + r * 0.2, cy - r * 0.05, r * 0.08, 0, Math.PI * 2);
ctx.arc(cx + r * 0.5, cy - r * 0.05, r * 0.08, 0, Math.PI * 2);
ctx.fill();`,
      },
      services: {
        label: "Services (general)",
        tags: "amenity=bank/post_office/police/fire_station/townhall/etc",
        colorKey: "services",
        code: `// Gear/cog
const teeth = 8;
const outerR = r * 0.95;
const innerR = r * 0.7;
const toothH = r * 0.25;
ctx.beginPath();
for (let i = 0; i < teeth; i++) {
  const a1 = (i / teeth) * Math.PI * 2;
  const a2 = ((i + 0.35) / teeth) * Math.PI * 2;
  const a3 = ((i + 0.5) / teeth) * Math.PI * 2;
  const a4 = ((i + 0.85) / teeth) * Math.PI * 2;
  if (i === 0) ctx.moveTo(cx + Math.cos(a1) * outerR, cy + Math.sin(a1) * outerR);
  ctx.lineTo(cx + Math.cos(a2) * outerR, cy + Math.sin(a2) * outerR);
  ctx.lineTo(cx + Math.cos(a2) * innerR, cy + Math.sin(a2) * innerR);
  ctx.lineTo(cx + Math.cos(a4) * innerR, cy + Math.sin(a4) * innerR);
  ctx.lineTo(cx + Math.cos(a4) * outerR, cy + Math.sin(a4) * outerR);
}
ctx.closePath();
haloFill();
// Center hole
ctx.beginPath();
ctx.arc(cx, cy, r * 0.28, 0, Math.PI * 2);
ctx.fillStyle = "white";
ctx.fill();`,
      },
    },
  },
  {
    title: "Transport",
    glyphs: {
      fuel: {
        label: "Fuel / Gas Station",
        tags: "amenity=fuel",
        colorKey: "transport",
        code: `// Gas pump
// Pump body
ctx.beginPath();
ctx.roundRect(cx - r * 0.6, cy - r * 0.5, r * 1.0, r * 1.3, 2);
haloFill();
// Pump top / display (white)
ctx.fillStyle = "white";
ctx.fillRect(cx - r * 0.4, cy - r * 0.3, r * 0.6, r * 0.35);
// Nozzle hose (right side)
ctx.beginPath();
ctx.moveTo(cx + r * 0.4, cy - r * 0.1);
ctx.lineTo(cx + r * 0.8, cy - r * 0.5);
ctx.lineTo(cx + r * 0.9, cy - r * 0.3);
haloStroke(1.5);
// Base
ctx.beginPath();
ctx.rect(cx - r * 0.75, cy + r * 0.8, r * 1.3, r * 0.15);
haloFill();`,
      },
      charging: {
        label: "EV Charging",
        tags: "amenity=charging_station",
        colorKey: "transport",
        code: `// Lightning bolt
ctx.beginPath();
ctx.moveTo(cx + r * 0.3, cy - r * 1.1);
ctx.lineTo(cx - r * 0.4, cy + r * 0.1);
ctx.lineTo(cx + r * 0.1, cy + r * 0.1);
ctx.lineTo(cx - r * 0.3, cy + r * 1.1);
ctx.lineTo(cx + r * 0.4, cy - r * 0.1);
ctx.lineTo(cx - r * 0.1, cy - r * 0.1);
ctx.closePath();
haloFill();`,
      },
      parking: {
        label: "Parking",
        tags: "amenity=parking/parking_entrance",
        colorKey: "transport",
        code: `// P in a square
ctx.beginPath();
ctx.roundRect(cx - r * 0.9, cy - r * 0.9, r * 1.8, r * 1.8, 3);
haloFill();
// Letter P (white)
ctx.fillStyle = "white";
ctx.font = "bold " + (r * 1.4) + "px Arial";
ctx.textAlign = "center";
ctx.textBaseline = "middle";
ctx.fillText("P", cx, cy + r * 0.05);`,
      },
      public_transport: {
        label: "Public Transport",
        tags: "amenity=bus_station/ferry_terminal/taxi",
        colorKey: "transport",
        code: `// Bus front view
const bw = r * 1.2, bh = r * 1.3;
ctx.beginPath();
ctx.roundRect(cx - bw / 2, cy - bh / 2, bw, bh, 3);
haloFill();
// Windshield (white)
ctx.fillStyle = "white";
ctx.beginPath();
ctx.roundRect(cx - bw * 0.38, cy - bh * 0.35, bw * 0.76, bh * 0.35, 1);
ctx.fill();
// Headlights
ctx.beginPath();
ctx.arc(cx - bw * 0.3, cy + bh * 0.25, r * 0.12, 0, Math.PI * 2);
ctx.arc(cx + bw * 0.3, cy + bh * 0.25, r * 0.12, 0, Math.PI * 2);
ctx.fillStyle = "white";
ctx.fill();`,
      },
      bike_rental: {
        label: "Bike Rental",
        tags: "amenity=bicycle_rental",
        colorKey: "transport",
        code: `// Bicycle
const wheelR = r * 0.4;
const wheelY = cy + r * 0.3;
// Wheels
ctx.beginPath();
ctx.arc(cx - r * 0.55, wheelY, wheelR, 0, Math.PI * 2);
haloStroke(1.5);
ctx.beginPath();
ctx.arc(cx + r * 0.55, wheelY, wheelR, 0, Math.PI * 2);
haloStroke(1.5);
// Frame
ctx.beginPath();
// Down tube + seat tube
ctx.moveTo(cx + r * 0.55, wheelY);
ctx.lineTo(cx - r * 0.1, cy - r * 0.3);
ctx.lineTo(cx - r * 0.55, wheelY);
// Top tube
ctx.moveTo(cx - r * 0.1, cy - r * 0.3);
ctx.lineTo(cx + r * 0.3, cy - r * 0.3);
ctx.lineTo(cx + r * 0.55, wheelY);
// Handlebar
ctx.moveTo(cx + r * 0.15, cy - r * 0.55);
ctx.lineTo(cx + r * 0.3, cy - r * 0.3);
haloStroke(1.2);
// Seat
ctx.beginPath();
ctx.moveTo(cx - r * 0.25, cy - r * 0.45);
ctx.lineTo(cx + r * 0.05, cy - r * 0.45);
haloStroke(2.0);`,
      },
    },
  },
  {
    title: "Education",
    glyphs: {
      education: {
        label: "Education",
        tags: "amenity=school/university/college/kindergarten/etc",
        colorKey: "education",
        code: `// Graduation cap
// Cap top (diamond shape)
ctx.beginPath();
ctx.moveTo(cx, cy - r * 0.7);
ctx.lineTo(cx + r * 1.2, cy - r * 0.1);
ctx.lineTo(cx, cy + r * 0.3);
ctx.lineTo(cx - r * 1.2, cy - r * 0.1);
ctx.closePath();
haloFill();
// Tassel string
ctx.beginPath();
ctx.moveTo(cx, cy - r * 0.1);
ctx.lineTo(cx + r * 0.8, cy + r * 0.5);
ctx.lineTo(cx + r * 0.8, cy + r * 0.9);
haloStroke(1.0);
// Tassel end
ctx.beginPath();
ctx.arc(cx + r * 0.8, cy + r * 0.9, r * 0.12, 0, Math.PI * 2);
haloFill();`,
      },
    },
  },
  {
    title: "Nightlife",
    glyphs: {
      nightlife: {
        label: "Nightlife",
        tags: "amenity=bar/pub/nightclub/biergarten/casino",
        colorKey: "nightlife",
        code: `// Cocktail glass
ctx.beginPath();
ctx.moveTo(cx - r * 0.75, cy - r * 0.6);
ctx.lineTo(cx + r * 0.75, cy - r * 0.6);
ctx.lineTo(cx, cy + r * 0.2);
ctx.closePath();
haloFill();
// Stem
ctx.beginPath();
ctx.moveTo(cx, cy + r * 0.2);
ctx.lineTo(cx, cy + r * 0.8);
ctx.moveTo(cx - r * 0.35, cy + r * 0.8);
ctx.lineTo(cx + r * 0.35, cy + r * 0.8);
haloStroke(1.2);`,
      },
    },
  },
  {
    title: "Recreation",
    glyphs: {
      recreation: {
        label: "Recreation",
        tags: "sport=table_tennis",
        colorKey: "services",
        code: `// Table tennis paddle
const pr = r * 0.6;
ctx.beginPath();
ctx.arc(cx, cy - r * 0.15, pr, 0, Math.PI * 2);
haloFill();
// Handle
ctx.beginPath();
ctx.moveTo(cx - r * 0.15, cy + pr * 0.6);
ctx.lineTo(cx + r * 0.15, cy + pr * 0.6);
ctx.lineTo(cx + r * 0.12, cy + r);
ctx.lineTo(cx - r * 0.12, cy + r);
ctx.closePath();
haloFill();`,
      },
      basketball: {
        label: "Basketball Court",
        tags: "sport=basketball",
        colorKey: "services",
        code: `// Basketball — circle with curved lines
const ballR = r * 0.9;
ctx.beginPath();
ctx.arc(cx, cy, ballR, 0, Math.PI * 2);
haloFill();
// Horizontal seam
ctx.beginPath();
ctx.moveTo(cx - ballR, cy);
ctx.lineTo(cx + ballR, cy);
ctx.strokeStyle = "white";
ctx.lineWidth = 1.0;
ctx.stroke();
// Vertical seam (curved)
ctx.beginPath();
ctx.moveTo(cx, cy - ballR);
ctx.bezierCurveTo(cx + ballR * 0.3, cy - ballR * 0.5, cx + ballR * 0.3, cy + ballR * 0.5, cx, cy + ballR);
ctx.strokeStyle = "white";
ctx.lineWidth = 1.0;
ctx.stroke();
// Left curve
ctx.beginPath();
ctx.moveTo(cx, cy - ballR);
ctx.bezierCurveTo(cx - ballR * 0.3, cy - ballR * 0.5, cx - ballR * 0.3, cy + ballR * 0.5, cx, cy + ballR);
ctx.strokeStyle = "white";
ctx.lineWidth = 1.0;
ctx.stroke();`,
      },
    },
  },
];

const SIZES = [16, 20, 24, 28, 32, 36];
const container = document.getElementById("container");

function renderGlyphScaled(canvas, code, color, size) {
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const cx = size / 2;
  const cy = size / 2;
  const r = size * 0.35;
  const colorStr = `rgb(${color.r},${color.g},${color.b})`;
  const haloStroke = (lineWidth) => {
    ctx.lineWidth = lineWidth + 2;
    ctx.strokeStyle = "white";
    ctx.stroke();
    ctx.lineWidth = lineWidth;
    ctx.strokeStyle = colorStr;
    ctx.stroke();
  };
  const haloFill = () => {
    ctx.lineWidth = 2;
    ctx.strokeStyle = "white";
    ctx.stroke();
    ctx.fillStyle = colorStr;
    ctx.fill();
  };
  try {
    const fn = new Function("ctx", "cx", "cy", "r", "colorStr", "haloStroke", "haloFill", code);
    fn(ctx, cx, cy, r, colorStr, haloStroke, haloFill);
    return null;
  } catch (e) {
    return e.message;
  }
}

for (const section of SECTIONS) {
  const heading = document.createElement("h2");
  heading.textContent = section.title;
  container.appendChild(heading);

  for (const [id, glyph] of Object.entries(section.glyphs)) {
    const color = COLORS[glyph.colorKey];
    const row = document.createElement("div");
    row.className = "glyph-row";

    const info = document.createElement("div");
    info.className = "glyph-info";
    info.innerHTML = `
      <h3><span class="color-swatch" style="background:rgb(${color.r},${color.g},${color.b})"></span>${glyph.label}</h3>
      <div class="tags">${id}</div>
      <div class="tags">${glyph.tags}</div>
    `;
    row.appendChild(info);

    const previews = document.createElement("div");
    previews.className = "glyph-previews";
    const canvases = [];
    for (const size of SIZES) {
      const wrap = document.createElement("div");
      wrap.className = "glyph-preview";
      const canvas = document.createElement("canvas");
      canvas.style.width = size + "px";
      canvas.style.height = size + "px";
      wrap.appendChild(canvas);
      const label = document.createElement("div");
      label.className = "size-label";
      label.textContent = size + "px";
      wrap.appendChild(label);
      previews.appendChild(wrap);
      canvases.push({ canvas, size });
    }
    row.appendChild(previews);

    const codeCol = document.createElement("div");
    codeCol.className = "glyph-code";
    const textarea = document.createElement("textarea");
    textarea.value = glyph.code;
    codeCol.appendChild(textarea);
    const btn = document.createElement("button");
    btn.textContent = "Update";
    codeCol.appendChild(btn);
    const errorDiv = document.createElement("div");
    errorDiv.className = "error";
    codeCol.appendChild(errorDiv);
    row.appendChild(codeCol);

    container.appendChild(row);

    function doRender() {
      let lastErr = null;
      for (const { canvas, size } of canvases) {
        canvas.width = size * 2;
        canvas.height = size * 2;
        const ctx = canvas.getContext("2d");
        ctx.scale(2, 2);
        const err = renderGlyphScaled(canvas, textarea.value, color, size);
        if (err) lastErr = err;
      }
      errorDiv.textContent = lastErr || "";
    }

    btn.addEventListener("click", doRender);
    doRender();
  }
}

</script>
</body>
</html>
