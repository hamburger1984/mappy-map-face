# Tileset Design
# One tileset per rendering group, optimized for coverage and performance

# =============================================================================
# DESIGN PRINCIPLES
# =============================================================================
# 1. Each tileset corresponds to one rendering group (same LOD, same features)
# 2. Tile size chosen so viewport requires ≥4 tiles (good balance: not too many, not too few)
# 3. At smallest view in group: ~4 tiles loaded
# 4. At largest view in group: ~9-16 tiles loaded (still reasonable)
# 5. Each tileset only contains features needed for its rendering group's LOD

# =============================================================================
# TILESET DEFINITIONS
# =============================================================================

tilesets:
  # ===========================================================================
  # TILESET 1: Street Level Detail (100m - 1000m views)
  # ===========================================================================
  - id: "t1_street"
    name: "Street Level Detail"
    rendering_group: 1
    lod: 4
    view_range_meters: [100, 1000]

    # Tile size calculation:
    # - Smallest view: 100m → want ~4 tiles → tile = 50m
    # - Largest view: 1000m → would load ~400 tiles (too many!)
    # - Compromise: tile = 200m
    #   - At 100m view: ~1 tile (acceptable for very close zoom)
    #   - At 1000m view: ~25 tiles (acceptable)
    tile_size_meters: 200
    tile_zoom_equivalent: 16  # Web Mercator Z16 ≈ 150m at lat 53°

    # Coverage analysis:
    coverage:
      at_100m_view: {tiles_loaded: 1, coverage: "100%"}
      at_500m_view: {tiles_loaded: 9, coverage: "64%"}
      at_1000m_view: {tiles_loaded: 25, coverage: "64%"}

    # Features included (LOD 4 = everything)
    features:
      - coastline
      - water_bodies  # All sizes
      - major_rivers
      - minor_waterways
      - forests  # All sizes
      - motorways_trunk
      - primary_roads
      - secondary_roads
      - tertiary_roads
      - residential_roads
      - minor_roads  # LOD 3+
      - major_rail
      - subway_light_rail
      - tram
      - parks
      - agriculture
      - residential_landuse
      - commercial_landuse
      - industrial_landuse
      - cemeteries
      - military
      - railway_yards
      - allotments
      - construction
      - education
      - religious
      - quarries
      - buildings  # LOD 2+
      - country_borders
      - cities
      - large_towns
      - towns
      - large_villages
      - villages
      - suburbs
      - hamlets  # LOD 3+
      - localities  # LOD 4
      - pois  # LOD 4

    simplification:
      # No simplification - show full detail
      epsilon_m: 0
      disabled: true

  # ===========================================================================
  # TILESET 2: Neighborhood (1500m - 2000m views)
  # ===========================================================================
  - id: "t2_neighborhood"
    name: "Neighborhood"
    rendering_group: 2
    lod: 3
    view_range_meters: [1500, 2000]

    # Tile size calculation:
    # - Smallest view: 1500m → want ~4 tiles → tile = 750m
    # - Largest view: 2000m → would load ~9 tiles
    # - Use: tile = 750m
    tile_size_meters: 750
    tile_zoom_equivalent: 14  # Web Mercator Z14 ≈ 600m at lat 53°

    coverage:
      at_1500m_view: {tiles_loaded: 4, coverage: "100%"}
      at_2000m_view: {tiles_loaded: 9, coverage: "84%"}

    # Features included (LOD 3 = buildings + more roads, no POIs)
    features:
      - coastline
      - water_bodies  # All sizes
      - major_rivers
      - minor_waterways
      - forests  # All sizes
      - motorways_trunk
      - primary_roads
      - secondary_roads
      - tertiary_roads
      - residential_roads
      - minor_roads  # LOD 3+
      - major_rail
      - subway_light_rail
      - tram
      - parks
      - agriculture
      - residential_landuse
      - commercial_landuse
      - industrial_landuse
      - cemeteries
      - military
      - railway_yards
      - allotments
      - construction
      - education
      - religious
      - quarries
      - buildings  # LOD 2+
      - country_borders
      - cities
      - large_towns
      - towns
      - large_villages
      - villages
      - suburbs
      - hamlets  # LOD 3+
      # NO pois (LOD 4 only)
      # NO localities (LOD 4 only)

    simplification:
      epsilon_m: 5
      apply_to: ["water_bodies", "forests", "landuse", "buildings"]

  # ===========================================================================
  # TILESET 3: District (3000m - 7000m views)
  # ===========================================================================
  - id: "t3_district"
    name: "District"
    rendering_group: 3
    lod: 2
    view_range_meters: [3000, 7000]

    # Tile size calculation:
    # - Smallest view: 3000m → want ~4 tiles → tile = 1500m
    # - Largest view: 7000m → would load ~25 tiles
    # - Use: tile = 2000m
    tile_size_meters: 2000
    tile_zoom_equivalent: 13  # Web Mercator Z13 ≈ 1200m at lat 53°

    coverage:
      at_3000m_view: {tiles_loaded: 4, coverage: "89%"}
      at_5000m_view: {tiles_loaded: 9, coverage: "64%"}
      at_7000m_view: {tiles_loaded: 16, coverage: "82%"}

    # Features included (LOD 2 = most features, no minor roads/hamlets/POIs)
    features:
      - coastline
      - water_bodies  # All sizes
      - major_rivers
      - minor_waterways
      - forests  # All sizes
      - motorways_trunk
      - primary_roads
      - secondary_roads
      - tertiary_roads
      - residential_roads
      # NO minor_roads (LOD 3+)
      - major_rail
      - subway_light_rail
      - tram
      - parks
      - agriculture
      - residential_landuse
      - commercial_landuse
      - industrial_landuse
      - cemeteries
      - military
      - railway_yards
      - allotments
      - construction
      - education
      - religious
      - quarries
      - buildings  # LOD 2+
      - country_borders
      - cities
      - large_towns
      - towns
      - large_villages
      - villages
      - suburbs
      # NO hamlets (LOD 3+)
      # NO localities (LOD 4)
      # NO pois (LOD 4)

    simplification:
      epsilon_m: 10
      apply_to: ["water_bodies", "forests", "landuse", "buildings", "roads", "railways"]

  # ===========================================================================
  # TILESET 4: City - Fine (10km - 15km views)
  # ===========================================================================
  - id: "t4_city_fine"
    name: "City Fine"
    rendering_group: 4
    lod: 1
    view_range_meters: [10000, 15000]

    # Tile size calculation:
    # - Smallest view: 10km → want ~4 tiles → tile = 5km
    # - Largest view: 15km → would load ~9 tiles
    # - Use: tile = 5km
    tile_size_meters: 5000
    tile_zoom_equivalent: 12  # Web Mercator Z12 ≈ 2400m at lat 53°

    coverage:
      at_10000m_view: {tiles_loaded: 4, coverage: "100%"}
      at_15000m_view: {tiles_loaded: 9, coverage: "100%"}

    # Features included (LOD 1 = major + secondary, no tertiary/residential/buildings)
    features:
      - coastline
      - water_bodies  # Medium+ (>0.01km²)
      - major_rivers
      # NO minor_waterways (LOD 2+)
      - forests  # Medium+ (>0.01km²)
      - motorways_trunk
      - primary_roads
      - secondary_roads
      # NO tertiary_roads (LOD 2+)
      # NO residential_roads (LOD 2+)
      # NO minor_roads (LOD 3+)
      - major_rail
      - subway_light_rail
      # NO tram (LOD 2+)
      - parks
      - agriculture
      - residential_landuse
      - commercial_landuse
      - industrial_landuse
      - cemeteries
      - military
      - railway_yards
      # NO allotments (LOD 2+)
      # NO construction (LOD 2+)
      # NO education (LOD 2+)
      # NO religious (LOD 2+)
      # NO quarries (LOD 2+)
      # NO buildings (LOD 2+)
      - country_borders
      - cities
      - large_towns
      - towns
      - large_villages
      # NO villages (LOD 2+)
      # NO suburbs (LOD 2+)
      # NO hamlets (LOD 3+)
      # NO localities (LOD 4)
      # NO pois (LOD 4)

    simplification:
      epsilon_m: 25
      apply_to: ["water_bodies", "forests", "landuse", "roads", "railways"]

  # ===========================================================================
  # TILESET 5: City - Wide (20km - 70km views)
  # ===========================================================================
  - id: "t5_city_wide"
    name: "City Wide"
    rendering_group: 5
    lod: 1
    view_range_meters: [20000, 70000]

    # Tile size calculation:
    # - Smallest view: 20km → want ~4 tiles → tile = 10km
    # - Largest view: 70km → would load ~49 tiles (too many!)
    # - Compromise: tile = 15km
    #   - At 20km view: ~4 tiles
    #   - At 70km view: ~25 tiles
    tile_size_meters: 15000
    tile_zoom_equivalent: 11  # Web Mercator Z11 ≈ 4800m at lat 53°

    coverage:
      at_20000m_view: {tiles_loaded: 4, coverage: "90%"}
      at_50000m_view: {tiles_loaded: 16, coverage: "72%"}
      at_70000m_view: {tiles_loaded: 25, coverage: "73%"}

    # Features included (same as t4_city_fine - LOD 1)
    features:
      - coastline
      - water_bodies  # Medium+ (>0.01km²)
      - major_rivers
      - forests  # Medium+ (>0.01km²)
      - motorways_trunk
      - primary_roads
      - secondary_roads
      - major_rail
      - subway_light_rail
      - parks
      - agriculture
      - residential_landuse
      - commercial_landuse
      - industrial_landuse
      - cemeteries
      - military
      - railway_yards
      - country_borders
      - cities
      - large_towns
      - towns
      - large_villages

    simplification:
      epsilon_m: 50
      apply_to: ["water_bodies", "forests", "landuse", "roads", "railways"]

  # ===========================================================================
  # TILESET 6: Regional (100km - 150km views)
  # ===========================================================================
  - id: "t6_regional"
    name: "Regional"
    rendering_group: 6
    lod: 0
    view_range_meters: [100000, 150000]

    # Tile size calculation:
    # - Smallest view: 100km → want ~4 tiles → tile = 50km
    # - Largest view: 150km → would load ~9 tiles
    # - Use: tile = 50km
    tile_size_meters: 50000
    tile_zoom_equivalent: 9  # Web Mercator Z9 ≈ 19km at lat 53°

    coverage:
      at_100000m_view: {tiles_loaded: 4, coverage: "100%"}
      at_150000m_view: {tiles_loaded: 9, coverage: "100%"}

    # Features included (LOD 0 = major features only)
    features:
      - coastline
      - water_bodies  # Large only (>1km²)
      # NO major_rivers (LOD 1+)
      # NO minor_waterways (LOD 2+)
      - forests  # Large only (>1km²)
      - motorways_trunk
      - primary_roads
      # NO secondary_roads (LOD 1+)
      # NO tertiary_roads (LOD 2+)
      # NO residential_roads (LOD 2+)
      # NO minor_roads (LOD 3+)
      - major_rail
      # NO subway_light_rail (LOD 1+)
      # NO tram (LOD 2+)
      # NO parks (LOD 1+)
      # NO agriculture (LOD 1+)
      # NO residential_landuse (LOD 1+)
      # NO commercial_landuse (LOD 1+)
      # NO industrial_landuse (LOD 1+)
      # NO cemeteries (LOD 1+)
      # NO military (LOD 1+)
      # NO railway_yards (LOD 1+)
      # NO allotments (LOD 2+)
      # NO construction (LOD 2+)
      # NO education (LOD 2+)
      # NO religious (LOD 2+)
      # NO quarries (LOD 2+)
      # NO buildings (LOD 2+)
      - country_borders
      - cities
      - large_towns
      # NO towns (LOD 1+)
      # NO large_villages (LOD 1+)
      # NO villages (LOD 2+)
      # NO suburbs (LOD 2+)
      # NO hamlets (LOD 3+)
      # NO localities (LOD 4)
      # NO pois (LOD 4)

    simplification:
      epsilon_m: 200
      apply_to: ["water_bodies", "forests", "roads", "railways", "coastline"]

  # ===========================================================================
  # TILESET 7: Continental (200km+ views)
  # ===========================================================================
  - id: "t7_continental"
    name: "Continental"
    rendering_group: 7
    lod: 0
    view_range_meters: [200000, 1000000]

    # Tile size calculation:
    # - View: 200km → want ~4 tiles → tile = 100km
    # - Use: tile = 100km
    tile_size_meters: 100000
    tile_zoom_equivalent: 8  # Web Mercator Z8 ≈ 38km at lat 53°

    coverage:
      at_200000m_view: {tiles_loaded: 4, coverage: "100%"}
      at_500000m_view: {tiles_loaded: 25, coverage: "100%"}

    # Features included (same as t6_regional - LOD 0)
    features:
      - coastline
      - water_bodies  # Large only (>1km²)
      - forests  # Large only (>1km²)
      - motorways_trunk
      - primary_roads
      - major_rail
      - country_borders
      - cities
      - large_towns

    simplification:
      epsilon_m: 500
      apply_to: ["water_bodies", "forests", "roads", "railways", "coastline"]

# =============================================================================
# SUMMARY TABLE
# =============================================================================
#
# | Tileset | View Range    | Tile Size | Min Tiles | Max Tiles | Features Count |
# |---------|---------------|-----------|-----------|-----------|----------------|
# | t1      | 100m-1km      | 200m      | 1         | 25        | ALL (60+)      |
# | t2      | 1.5km-2km     | 750m      | 4         | 9         | ~55 (no POIs)  |
# | t3      | 3km-7km       | 2km       | 4         | 16        | ~50            |
# | t4      | 10km-15km     | 5km       | 4         | 9         | ~25            |
# | t5      | 20km-70km     | 15km      | 4         | 25        | ~25            |
# | t6      | 100km-150km   | 50km      | 4         | 9         | ~8             |
# | t7      | 200km+        | 100km     | 4         | 25        | ~8             |
#
# =============================================================================
# SIZE-BASED FILTERING RULES
# =============================================================================
#
# Applied during tile generation to determine which features go in which tilesets:
#
# Water bodies:
#   - Large (>1km²):    t1, t2, t3, t4, t5, t6, t7
#   - Medium (0.01-1km²): t1, t2, t3, t4, t5
#   - Small (<0.01km²):   t1, t2, t3
#
# Forests:
#   - Large (>1km²):    t1, t2, t3, t4, t5, t6, t7
#   - Medium (0.01-1km²): t1, t2, t3, t4, t5
#   - Small (<0.01km²):   t1, t2, t3
#
# =============================================================================
# IMPLEMENTATION NOTES
# =============================================================================
#
# 1. Tile generation (step_3_generate_tiles.py):
#    - For each feature, determine which tilesets it belongs to based on:
#      a) Its minLOD (which LOD levels it's visible at)
#      b) Its size (area for polygons)
#    - Generate tiles at tile_size_meters for each tileset
#    - Apply appropriate simplification epsilon_m per tileset
#
# 2. Renderer (map_renderer.js):
#    - Replace getZoomLevelForScale() with getTilesetForView(viewWidthMeters)
#    - Load tiles from appropriate tileset directory
#    - Each tileset stored in separate directory: tiles/t1/, tiles/t2/, etc.
#
# 3. Storage:
#    tiles/
#      t1/  # 200m tiles - street level
#      t2/  # 750m tiles - neighborhood
#      t3/  # 2km tiles - district
#      t4/  # 5km tiles - city fine
#      t5/  # 15km tiles - city wide
#      t6/  # 50km tiles - regional
#      t7/  # 100km tiles - continental
